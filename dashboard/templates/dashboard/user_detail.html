{% extends 'dashboard/base.html' %}
{% load static %}

{% block title %}Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ú©Ø§Ø±Ø¨Ø± {{ user.username }} | Mobix{% endblock %}

{% block content %}
<div class="space-y-6 fade-in">
    <!-- Ù‡Ø¯Ø± ØµÙØ­Ù‡ -->
    <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
        <div class="flex items-center gap-3">
            <a href="{% url 'users_list' %}" 
               class="text-gray-500 hover:text-gray-700 transition">
                <i class="ti ti-arrow-right text-xl"></i>
            </a>
            <div>
                <h1 class="text-2xl font-bold text-gray-900">ğŸ‘¤ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ú©Ø§Ø±Ø¨Ø±</h1>
                <p class="text-gray-600 mt-1">Ø¬Ø²Ø¦ÛŒØ§Øª Ú©Ø§Ù…Ù„ Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ</p>
            </div>
        </div>
        
        <!-- Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø¹Ù…Ù„ÛŒØ§ØªÛŒ -->
        <div class="flex items-center gap-3">
            <a href="{% url 'edit_user' user.id %}" 
               class="flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white font-medium py-2.5 px-4 rounded-xl transition-all">
                <i class="ti ti-edit"></i>
                ÙˆÛŒØ±Ø§ÛŒØ´ Ú©Ø§Ø±Ø¨Ø±
            </a>
            
            <!-- Ú©Ù¾ÛŒ Ù„ÛŒÙ†Ú© Ù¾Ø±ÙˆÙØ§ÛŒÙ„ -->
            <button onclick="copyUserLink()" 
                    class="flex items-center gap-2 bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium py-2.5 px-4 rounded-xl transition-all">
                <i class="ti ti-link"></i>
                Ú©Ù¾ÛŒ Ù„ÛŒÙ†Ú©
            </button>
        </div>
    </div>
    
    <!-- Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ø§ØµÙ„ÛŒ -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- Ø³ØªÙˆÙ† Ú†Ù¾: Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø± -->
        <div class="lg:col-span-2 space-y-6">
            <!-- Ú©Ø§Ø±Øª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§ØµÙ„ÛŒ -->
            <div class="bg-white rounded-2xl shadow-lg border border-gray-200 p-6">
                <h2 class="text-xl font-bold text-gray-900 mb-6 pb-4 border-b border-gray-200">
                    Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ
                </h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Ø¢ÙˆØ§ØªØ§Ø± Ùˆ Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ -->
                    <div class="md:col-span-2">
                        <div class="flex items-center gap-4">
                            <div class="w-24 h-24 rounded-2xl 
                                {% if user.is_staff %}bg-gradient-to-r from-purple-500 to-pink-500
                                {% else %}bg-gradient-to-r from-blue-500 to-cyan-500{% endif %} 
                                flex items-center justify-center text-white text-4xl font-bold">
                                {{ user.username|first|upper }}
                            </div>
                            <div>
                                <h3 class="text-2xl font-bold text-gray-900">
                                    {{ user.get_full_name|default:user.username }}
                                </h3>
                                <p class="text-gray-600 mt-1">@{{ user.username }}</p>
                                
                                <!-- Ø¨Ø¬ Ù‡Ø§ÛŒ ÙˆØ¶Ø¹ÛŒØª -->
                                <div class="flex flex-wrap gap-2 mt-3">
                                    <!-- ÙˆØ¶Ø¹ÛŒØª ÙØ¹Ø§Ù„ -->
                                    <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium 
                                        {% if user.is_active %}bg-green-100 text-green-800
                                        {% else %}bg-red-100 text-red-800{% endif %}">
                                        <i class="ti 
                                            {% if user.is_active %}ti-user-check
                                            {% else %}ti-user-off{% endif %} 
                                            text-xs ml-1"></i>
                                        {% if user.is_active %}ÙØ¹Ø§Ù„{% else %}ØºÛŒØ±ÙØ¹Ø§Ù„{% endif %}
                                    </span>
                                    
                                    <!-- Ù†Ù‚Ø´ -->
                                    <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium 
                                        {% if user.is_superuser %}bg-red-100 text-red-800
                                        {% elif user.is_staff %}bg-purple-100 text-purple-800
                                        {% else %}bg-gray-100 text-gray-800{% endif %}">
                                        <i class="ti 
                                            {% if user.is_superuser %}ti-crown
                                            {% elif user.is_staff %}ti-shield
                                            {% else %}ti-user{% endif %} 
                                            text-xs ml-1"></i>
                                        {% if user.is_superuser %}Ø³ÙˆÙ¾Ø±Ø§Ø¯Ù…ÛŒÙ†
                                        {% elif user.is_staff %}Ù…Ø¯ÛŒØ± Ø³ÛŒØ³ØªÙ…
                                        {% else %}Ú©Ø§Ø±Ø¨Ø± Ø¹Ø§Ø¯ÛŒ{% endif %}
                                    </span>
                                    
                                    <!-- ØªØ§Ø±ÛŒØ® Ø¹Ø¶ÙˆÛŒØª -->
                                    <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-800">
                                        <i class="ti ti-calendar text-xs ml-1"></i>
                                        Ø¹Ø¶Ùˆ Ø§Ø² {{ user.date_joined|date:"Y/m/d" }}
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Ø§Ø·Ù„Ø§Ø¹Ø§Øª ØªÙ…Ø§Ø³ -->
                    <div>
                        <h4 class="font-bold text-gray-700 mb-3">Ø§Ø·Ù„Ø§Ø¹Ø§Øª ØªÙ…Ø§Ø³</h4>
                        <div class="space-y-3">
                            <div class="flex items-center">
                                <div class="w-10 h-10 bg-blue-100 text-blue-600 rounded-lg flex items-center justify-center ml-3">
                                    <i class="ti ti-mail"></i>
                                </div>
                                <div>
                                    <p class="text-gray-500 text-sm">Ø§ÛŒÙ…ÛŒÙ„</p>
                                    <a href="mailto:{{ user.email }}" class="text-gray-900 font-medium hover:text-blue-600">
                                        {{ user.email }}
                                    </a>
                                </div>
                            </div>
                            
                            {% if user.profile.phone %}
                            <div class="flex items-center">
                                <div class="w-10 h-10 bg-green-100 text-green-600 rounded-lg flex items-center justify-center ml-3">
                                    <i class="ti ti-phone"></i>
                                </div>
                                <div>
                                    <p class="text-gray-500 text-sm">ØªÙ„ÙÙ† Ù‡Ù…Ø±Ø§Ù‡</p>
                                    <a href="tel:{{ user.profile.phone }}" class="text-gray-900 font-medium hover:text-green-600">
                                        {{ user.profile.phone }}
                                    </a>
                                </div>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <!-- Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø´Ø®ØµÛŒ -->
                    <div>
                        <h4 class="font-bold text-gray-700 mb-3">Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø´Ø®ØµÛŒ</h4>
                        <div class="space-y-3">
                            {% if user.first_name or user.last_name %}
                            <div class="flex items-center">
                                <div class="w-10 h-10 bg-purple-100 text-purple-600 rounded-lg flex items-center justify-center ml-3">
                                    <i class="ti ti-id"></i>
                                </div>
                                <div>
                                    <p class="text-gray-500 text-sm">Ù†Ø§Ù… Ú©Ø§Ù…Ù„</p>
                                    <p class="text-gray-900 font-medium">
                                        {{ user.first_name }} {{ user.last_name }}
                                    </p>
                                </div>
                            </div>
                            {% endif %}
                            
                            <div class="flex items-center">
                                <div class="w-10 h-10 bg-amber-100 text-amber-600 rounded-lg flex items-center justify-center ml-3">
                                    <i class="ti ti-calendar"></i>
                                </div>
                                <div>
                                    <p class="text-gray-500 text-sm">Ø¢Ø®Ø±ÛŒÙ† ÙˆØ±ÙˆØ¯</p>
                                    <p class="text-gray-900 font-medium">
                                        {% if user.last_login %}
                                        {{ user.last_login|timesince }} Ù¾ÛŒØ´
                                        {% else %}
                                        Ù‡Ù†ÙˆØ² ÙˆØ§Ø±Ø¯ Ù†Ø´Ø¯Ù‡
                                        {% endif %}
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Ú©Ø§Ø±Øª Ø¢Ø¯Ø±Ø³ -->
            {% if user.profile.address %}
            <div class="bg-white rounded-2xl shadow-lg border border-gray-200 p-6">
                <h2 class="text-xl font-bold text-gray-900 mb-4">Ø¢Ø¯Ø±Ø³ Ú©Ø§Ø±Ø¨Ø±</h2>
                <div class="bg-gray-50 rounded-xl p-5 whitespace-pre-wrap text-gray-700">
                    {{ user.profile.address }}
                </div>
            </div>
            {% endif %}
        </div>
        
        <!-- Ø³ØªÙˆÙ† Ø±Ø§Ø³Øª: Ø¢Ù…Ø§Ø± Ùˆ Ø¹Ù…Ù„ÛŒØ§Øª -->
        <div class="space-y-6">
            <!-- Ú©Ø§Ø±Øª Ø¢Ù…Ø§Ø± -->
            <div class="bg-white rounded-2xl shadow-lg border border-gray-200 p-6">
                <h3 class="text-lg font-bold text-gray-900 mb-4">Ø¢Ù…Ø§Ø± Ú©Ø§Ø±Ø¨Ø±</h3>
                
                <div class="space-y-4">
                    <!-- Ø¯Ø±ØµØ¯ ØªÚ©Ù…ÛŒÙ„ Ù¾Ø±ÙˆÙØ§ÛŒÙ„ -->
                    <div>
                        <div class="flex justify-between text-sm text-gray-600 mb-1">
                            <span>ØªÚ©Ù…ÛŒÙ„ Ù¾Ø±ÙˆÙØ§ÛŒÙ„</span>
                            <span>{{ user.profile.profile_completion_percentage }}%</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2.5">
                            <div class="bg-blue-600 h-2.5 rounded-full" 
                                 style="width: {{ user.profile.profile_completion_percentage }}%"></div>
                        </div>
                    </div>
                    
                    <!-- ØªØ§Ø±ÛŒØ®â€ŒÙ‡Ø§ -->
                    <div class="space-y-2">
                        <div class="flex justify-between">
                            <span class="text-gray-600 text-sm">ØªØ§Ø±ÛŒØ® Ø¹Ø¶ÙˆÛŒØª:</span>
                            <span class="font-medium">{{ user.date_joined|date:"Y/m/d" }}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600 text-sm">Ø³Ø§Ø¹Øª Ø¹Ø¶ÙˆÛŒØª:</span>
                            <span class="font-medium">{{ user.date_joined|time }}</span>
                        </div>
                        {% if user.last_login %}
                        <div class="flex justify-between">
                            <span class="text-gray-600 text-sm">Ø¢Ø®Ø±ÛŒÙ† ÙˆØ±ÙˆØ¯:</span>
                            <span class="font-medium">{{ user.last_login|date:"Y/m/d H:i" }}</span>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <!-- Ú©Ø§Ø±Øª Ø¹Ù…Ù„ÛŒØ§Øª Ø³Ø±ÛŒØ¹ -->
            <div class="bg-white rounded-2xl shadow-lg border border-gray-200 p-6">
                <h3 class="text-lg font-bold text-gray-900 mb-4">Ø¹Ù…Ù„ÛŒØ§Øª Ø³Ø±ÛŒØ¹</h3>
                
                <div class="space-y-3">
                    <!-- ÙØ¹Ø§Ù„/ØºÛŒØ±ÙØ¹Ø§Ù„ -->
                    <form method="post" action="{% url 'toggle_user_active' user.id %}" class="w-full">
                        {% csrf_token %}
                        <button type="submit" 
                                onclick="return confirm('Ø¢ÛŒØ§ Ø§Ø² ØªØºÛŒÛŒØ± ÙˆØ¶Ø¹ÛŒØª Ú©Ø§Ø±Ø¨Ø± Ù…Ø·Ù…Ø¦Ù†ÛŒØ¯ØŸ')"
                                class="w-full flex items-center justify-center gap-2 
                                    {% if user.is_active %}bg-red-50 text-red-700 hover:bg-red-100
                                    {% else %}bg-green-50 text-green-700 hover:bg-green-100{% endif %} 
                                    font-medium py-2.5 px-4 rounded-xl transition-all">
                            <i class="ti {% if user.is_active %}ti-user-off{% else %}ti-user-check{% endif %}"></i>
                            {% if user.is_active %}ØºÛŒØ±ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù†{% else %}ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù†{% endif %} Ú©Ø§Ø±Ø¨Ø±
                        </button>
                    </form>
                    
                    <!-- ØªØºÛŒÛŒØ± Ù†Ù‚Ø´ -->
                    <form method="post" action="{% url 'toggle_user_staff' user.id %}" class="w-full">
                        {% csrf_token %}
                        <button type="submit" 
                                onclick="return confirm('Ø¢ÛŒØ§ Ø§Ø² ØªØºÛŒÛŒØ± Ù†Ù‚Ø´ Ú©Ø§Ø±Ø¨Ø± Ù…Ø·Ù…Ø¦Ù†ÛŒØ¯ØŸ')"
                                class="w-full flex items-center justify-center gap-2 
                                    {% if user.is_staff %}bg-gray-100 text-gray-700 hover:bg-gray-200
                                    {% else %}bg-purple-50 text-purple-700 hover:bg-purple-100{% endif %} 
                                    font-medium py-2.5 px-4 rounded-xl transition-all">
                            <i class="ti {% if user.is_staff %}ti-user{% else %}ti-shield{% endif %}"></i>
                            {% if user.is_staff %}Ø­Ø°Ù Ø§Ø² Ù…Ø¯ÛŒØ±Ø§Ù†{% else %}ØªØ¨Ø¯ÛŒÙ„ Ø¨Ù‡ Ù…Ø¯ÛŒØ±{% endif %}
                        </button>
                    </form>
                    
                    <!-- Ø§Ø±Ø³Ø§Ù„ Ø§ÛŒÙ…ÛŒÙ„ -->
                    <a href="mailto:{{ user.email }}?subject=Ù¾ÛŒØ§Ù… Ø§Ø² Mobix" 
                       class="w-full flex items-center justify-center gap-2 bg-blue-50 text-blue-700 hover:bg-blue-100 font-medium py-2.5 px-4 rounded-xl transition-all">
                        <i class="ti ti-mail"></i>
                        Ø§Ø±Ø³Ø§Ù„ Ø§ÛŒÙ…ÛŒÙ„
                    </a>
                    
                    <!-- Ø­Ø°Ù Ú©Ø§Ø±Ø¨Ø± -->
                    <form method="post" action="{% url 'delete_user' user.id %}" class="w-full">
                        {% csrf_token %}
                        <button type="submit" 
                                onclick="return confirm('Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø§ÛŒÙ† Ú©Ø§Ø±Ø¨Ø± Ù…Ø·Ù…Ø¦Ù†ÛŒØ¯ØŸ Ø§ÛŒÙ† Ø¹Ù…Ù„ ØºÛŒØ±Ù‚Ø§Ø¨Ù„ Ø¨Ø§Ø²Ú¯Ø´Øª Ø§Ø³Øª!')"
                                class="w-full flex items-center justify-center gap-2 bg-red-50 text-red-700 hover:bg-red-100 font-medium py-2.5 px-4 rounded-xl transition-all">
                            <i class="ti ti-trash"></i>
                            Ø­Ø°Ù Ú©Ø§Ø±Ø¨Ø±
                        </button>
                    </form>
                </div>
            </div>
            
            <!-- Ú©Ø§Ø±Øª Ø§Ø·Ù„Ø§Ø¹Ø§Øª ÙÙ†ÛŒ -->
            <div class="bg-white rounded-2xl shadow-lg border border-gray-200 p-6">
                <h3 class="text-lg font-bold text-gray-900 mb-4">Ø§Ø·Ù„Ø§Ø¹Ø§Øª ÙÙ†ÛŒ</h3>
                
                <div class="space-y-3">
                    <div class="flex justify-between">
                        <span class="text-gray-600">ID Ú©Ø§Ø±Ø¨Ø±:</span>
                        <code class="bg-gray-100 px-2 py-1 rounded text-sm">{{ user.id }}</code>
                    </div>
                    
                    <div class="flex justify-between">
                        <span class="text-gray-600">Ø¢Ø®Ø±ÛŒÙ† Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ:</span>
                        <span class="font-medium">{{ user.profile.updated_at|date:"Y/m/d H:i" }}</span>
                    </div>
                </div>
                
                <!-- Ú©Ù¾ÛŒ ID -->
                <button onclick="copyUserId()" 
                        class="w-full mt-4 text-center text-sm text-gray-600 hover:text-gray-800 py-2 rounded-lg hover:bg-gray-50 transition">
                    <i class="ti ti-copy ml-1"></i>
                    Ú©Ù¾ÛŒ ID Ú©Ø§Ø±Ø¨Ø±
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Ù…ÙˆØ¯Ø§Ù„ Ú©Ù¾ÛŒ Ù…ÙˆÙÙ‚ -->
<div id="copyModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-2xl shadow-2xl w-full max-w-sm">
        <div class="p-6">
            <div class="text-center">
                <div class="w-16 h-16 bg-green-100 text-green-600 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="ti ti-check text-2xl"></i>
                </div>
                <h3 class="text-xl font-bold text-gray-900 mb-2" id="copyModalTitle">Ú©Ù¾ÛŒ Ø´Ø¯!</h3>
                <p class="text-gray-600" id="copyModalMessage">Ù…Ø­ØªÙˆØ§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ú©Ù¾ÛŒ Ø´Ø¯.</p>
            </div>
            <button onclick="closeCopyModal()" 
                    class="w-full mt-6 px-6 py-3 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition">
                Ø¨Ø§Ø´Ù‡
            </button>
        </div>
    </div>
</div>

<script>
// ==================== Ú©Ù¾ÛŒ Ù„ÛŒÙ†Ú© Ú©Ø§Ø±Ø¨Ø± ====================
function copyUserLink() {
    const link = window.location.href;
    navigator.clipboard.writeText(link).then(() => {
        showCopyModal('Ù„ÛŒÙ†Ú© Ú©Ù¾ÛŒ Ø´Ø¯', 'Ù„ÛŒÙ†Ú© ØµÙØ­Ù‡ Ú©Ø§Ø±Ø¨Ø± Ø¯Ø± Ú©Ù„ÛŒÙ¾â€ŒØ¨ÙˆØ±Ø¯ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯.');
    });
}

// ==================== Ú©Ù¾ÛŒ ID Ú©Ø§Ø±Ø¨Ø± ====================
function copyUserId() {
    const userId = '{{ user.id }}';
    navigator.clipboard.writeText(userId).then(() => {
        showCopyModal('ID Ú©Ù¾ÛŒ Ø´Ø¯', `Ø´Ù†Ø§Ø³Ù‡ Ú©Ø§Ø±Ø¨Ø± ${userId} Ú©Ù¾ÛŒ Ø´Ø¯.`);
    });
}

// ==================== Ù…Ø¯ÛŒØ±ÛŒØª Ù…ÙˆØ¯Ø§Ù„ Ú©Ù¾ÛŒ ====================
function showCopyModal(title, message) {
    document.getElementById('copyModalTitle').textContent = title;
    document.getElementById('copyModalMessage').textContent = message;
    document.getElementById('copyModal').classList.remove('hidden');
    document.getElementById('copyModal').classList.add('flex');
    document.body.style.overflow = 'hidden';
    
    // Ø¨Ø³ØªÙ† Ø®ÙˆØ¯Ú©Ø§Ø± Ø¨Ø¹Ø¯ Ø§Ø² 2 Ø«Ø§Ù†ÛŒÙ‡
    setTimeout(closeCopyModal, 2000);
}

function closeCopyModal() {
    document.getElementById('copyModal').classList.add('hidden');
    document.getElementById('copyModal').classList.remove('flex');
    document.body.style.overflow = 'auto';
}

// ==================== Ø¨Ø³ØªÙ† Ù…ÙˆØ¯Ø§Ù„ Ø¨Ø§ ESC ====================
document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        closeCopyModal();
    }
});

// ==================== Ø¨Ø³ØªÙ† Ù…ÙˆØ¯Ø§Ù„ Ø¨Ø§ Ú©Ù„ÛŒÚ© Ø®Ø§Ø±Ø¬ ====================
document.getElementById('copyModal').addEventListener('click', function(event) {
    if (event.target === this) {
        closeCopyModal();
    }
});
</script>

<style>
/* Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø³ÙØ§Ø±Ø´ÛŒ */
code {
    font-family: 'Vazir', monospace;
    direction: ltr;
}
</style>
{% endblock %}